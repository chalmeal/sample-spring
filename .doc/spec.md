**仕様**

サンプルプロジェクト内で提供する機能を定義する。

## 機能一覧
| No | 機能名 | 説明 |
| -- | ----- | --- |
| 1 | 認証 | ユーザーがシステムを利用するための認証機能を提供する。 |
| 2 | 認可 | ユーザーがシステムの機能を利用するための認可機能を提供する。 |
| 3 | 社員管理 | 社員管理機能を提供する。 |
| 4 | アカウント | システムのユーザー管理を提供する。 |
| 5 | ログ | システム上のログ監査機能を提供する。 |

## 1. 認証
ユーザーがシステムを利用するための認証機能を提供する。

### 1-1. ログイン
ユーザーはシステムを利用するためにログインする必要がある。ログインには以下の項目を要する。
| 項目名 | 必須 | 桁数 | 説明 |
| ----- | --- | --- | --- |
| メールアドレス | ◯ | 256 | ユーザーのメールアドレスを入力する。 |
| パスワード | ◯ | 64 | ユーザーが設定したパスワードを入力する。パスワードはシステム内では平文で管理しない。 |

### 1-2. MFA
本プロジェクトではMFA（多要素認証）については対応しない。

## 2. 認可
ユーザーがシステムの機能を利用するための認可機能を提供する。ログインに成功し、認証されるとシステムの機能を利用するための認可トークンを発行する。

### 2-1. 認可トークン
認可トークンはJWT（Json Web Token）を発行する。JWTに含まれるClaim値は以下の項目とする。
| 項目名（論理） | 項目名（物理） | 説明 |
| ----------- | ------------ | ---- |
| JWT発行者 | issuer | JWTの発行者。本システムの値で固定値とする。 |
| ユーザーID | subscriber | 認証に成功し、JWTを利用したいユーザーのID。 |
| 権限 | authority | ユーザーが保持する権限。 |
| 有効期限 | expire | 発行したJWTを利用できる期間。デフォルトで3600（1h）とする。 |

> Auth0などで推奨されているクレーム構成とは異なるため、必要に応じて再構成すること。

## 3. 社員管理
社員管理機能を提供する。

### 3-1. 社員情報
管理する社員情報は以下の項目とする。データベースとしての社員情報の詳細は[data.md]()を参照。
| 項目名 | 説明 |
| ----- | ---- |
| 社員ID | 社員を一意に識別するID。IDは入社年月+連番とする。IDとして扱う入社年月はハイフンを除く。 |
| 氏名 | 社員の氏名フルネーム。 |
| 氏名カナ | 社員の氏名フルネームのカタカナ表記。 |
| 所属部門 | 社員が所属する部門。 |
| 役職 | 社員の役職。 |
| 入社年月 | 社員が入社した年月。フォーマットはYYYY-MMとする。 |
| メールアドレス | 社員に連絡が取れるメールアドレス。ドメインは社内ドメインを利用する。 |
| 電話番号 | 社員に連絡が取れる電話番号。フォーマットはXXX-XXXX-XXXとする。 |
| 郵便番号 | 社員の現住所郵便番号。フォーマットはXXX-XXXXとする。 |
| 住所 | 社員の現住所。都道府県は省略せず、すべて管理する。 |
| 生年月日 | 社員の生年月日。フォーマットはYYYY-MM-DDとする。 |

### 3-2. 部門
各社員が所属する部門を管理する。部門には必ず1人部門長がおり、部門長含む社員が1名以上在籍する。管理する部門は以下とする。
| 部門名 |
| ----- |
| 総務部 |
| 人事部 |
| 営業部 |

### 3-3. 役職
各社員の役職を管理する。同じ役職を複数の社員が持つことがある。管理する役職は以下とする。
| 役職名 |
| ----- |
| 部長 |
| 課長 |
| 主任 |
| 一般社員 |
| 派遣社員 |

## 4. アカウント
システムを利用するユーザーのアカウント情報を管理する。

### 4-1. 登録
* アカウント登録時はメールアドレスを入力して仮登録をする。
* 仮登録をしたメールアドレス宛に本登録を促すURLが送信され、そのURLから本登録を行う。
* 本登録完了までの猶予時間は24時間とする。24時間以上を超えて本登録を行おうとするとエラーとなる。

### 4-2. 変更
* アカウントの登録完了後、変更が伴う場合はアカウント情報の変更ができる。
* 変更できる項目は以下の項目とする。

| 項目名       | 備考 |
| ----------- | --- |
| アカウント名  | |
| メールアドレス | |
| パスワード    | ユーザー自らのみ変更可能 |
| 権限         | 管理者権限を持つユーザーのみ変更可能 |
| 状態         | 管理者権限を持つユーザーのみ変更可能 |

### 4-3. 削除
* アカウントは物理削除されない。
* アカウントの状態を無効とすることで論理削除とする。また、一度無効にしたアカウントを再度有効にすることもある。
* アカウントの削除は管理者が行うこともあれば、ユーザー自ら行うこともある。

### 4-4. アカウントID
* アカウントIDはユーザーが任意に設定する一意な文字列とする。
* 後からアカウントIDを変更することはできない。

### 4-5. メールアドレス
* メールアドレスはシステム内で一意のメールアドレスとする。重複して登録することはできない。
* 重複したメールアドレスが登録されている場合であっても、システムはメールアドレスが登録済みであるメッセージは返さない。
  * 登録自体は通常通りの挙動をする。ただし、登録を試みたメールアドレス宛に本登録のメールを促すメールを送信しない。

### 4-6. 権限
* アカウントごとに権限を持つ。管理する権限は以下とする。

| 権限名       | 備考 |
| ----------- | --- |
| 管理者       | |
| 一般ユーザー  | |
| 権限なし     | 仮登録時点のアカウント |

## 5. ログ
アプリケーションの実行ログを保持する。
* 処理の実行者IDを保持する。実行者IDはその機能を実行したアカウントIDを記録する。
* ログ種別は以下とする。

| 種別 　|
| ----- |
| 成功　 |
| 失敗　 |
| 警告　 |
| 実行中　|

* カテゴリは以下とする。

| カテゴリ　|
| ------- |
| API 　　|
| バッチ 　|

* メッセージは成功失敗警告問わず、処理実行時に発生するメッセージを記録する。
* 処理が失敗（エラー）となった場合、エラー事由を記録する。エラー事由はアプリケーションレベルの例外スタックトレースではなく、ユーザーライクなメッセージを表示する。
* 実行日時は処理が完了した日時を記録する。実行中の処理は記録されない。

## 6. 共通

### 6-1. ページング
多くの情報を一覧取得で扱う場合、ページングで実装する。本プロジェクトにおけるページングの仕様は以下とする。
* 1ページあたりの取得する件数はアプリケーション側で30件の固定数とする。
* 一覧取得系のAPIはリクエストにページ番号をパラメタとして付与し、そのページ番号に応じて取得するデータが変動する。
* レスポンスするデータは加算されず、指定したページ番号に応じた最大30件のデータを返す。